<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>用户管理</title>
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="format-detection" content="telephone=no">
    <link rel="stylesheet" href="__STATIC__/layui/css/layui.css" media="all" />
    <link rel="stylesheet" href="__CSS__/bootstrap.min.css" media="all" />
    <link rel="stylesheet" href="__STATIC__/css/font_eolqem241z66flxr.css" media="all" />
    <style type="text/css">
        .layui-table td, .layui-table th{ text-align: center; }
        .layui-table td{ padding:5px; }
    </style>
</head>
<body class="childrenBody">
<div  id="myApp" >
    <form method="post" action="{:url('platformmanage/Userbg/index')}" >
        <blockquote class="layui-elem-quote news_search">
            <div class="layui-inline">
                <div class="layui-input-inline">
                    <input type="text" value="" placeholder="请输入关键字" name="seartch_advert" class="layui-input search_input">
                </div>
                <button type="submit" class="layui-btn search_btn">查询</button>
            </div>
            <div class="layui-inline"  id="putStateExamine">
                <div>
                    <input type="button" class="layui-btn" onclick="adduser()" value="添加">
                </div>
            </div>
        </blockquote>
    </form>
    <div class="layui-form links_list">
        <table class="layui-table">
            <colgroup>
                <col width="50">
                <col>
                <col>
                <col>
                <col>
                <col>
                <col>
                <col width="13%">
            </colgroup>
            <thead>
            <tr>
                <th><input type="checkbox" name="" lay-skin="primary" lay-filter="allChoose" id="allChoose"></th>
                <th style="text-align:left;">用户ID</th>
                <th>用户头像</th>
                <th>用户名字</th>
                <th>用户Email</th>
                <th>用户电话</th>
                <th>用户发布时间</th>
                <th>用户发布信息</th>
                <th>用户审核状态</th>
                <th>操作</th>
                <th>操作</th>
                <th>操作</th>
            </tr>
            </thead>
            {volist name="alluser" id="vo"}
            <tbody class="links_content">
            <tr>
                <th><input type="checkbox" name="" lay-skin="primary" lay-filter="allChoose" id="allChoose1"></th>
                <th style="text-align:left;">{$vo.user_id}</th>
                <th><img src="{$vo.user_image}" title="dish-name" /></th>
                <th>{$vo.user_name}</th>
                <th>{$vo.user_email}</th>
                <th>{$vo.user_phone}</th>
                <th>{$vo.user_time}</th>
                <th>{$vo.user_msg}</th>
                <th>{$vo.user_state}</th>
                <th>
                    <div class="layui-hide layui-show-md-block">
                        {if condition="$vo.user_state eq '1'"}
                        <button class="layui-btn" lockid="{$vo.user_id}" onclick="lock(this)">锁定</button>
                        {else/}
                        <button class="layui-btn" lockid="{$vo.user_id}" onclick="unlock(this)">解锁</button>
                        {/if}
                    </div>
                </th>
                <th><input type="button" class="layui-btn" delectid="{$vo.user_id}" onclick="delect(this)" value="删除"></th>
                <th>
                    <input type="button" class="layui-btn" changeid="{$vo.user_id}" onclick="change(this)" value="修改">

                </th>
            </tr>
            </tbody>
            {/volist}
        </table>
        {$page}
    </div>
    <div id="page">
    </div>
    <form class="layui-form" style="width:100%;border: 1px solid #e3e3e3;display: none;">
        <div class="layui-form-item">
            <label class="layui-form-label">登录名</label>
            <div class="layui-input-block">
                <input type="text" class="layui-input userName" lay-verify="required" placeholder="请输入登录名">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">邮箱</label>
            <div class="layui-input-block">
                <input type="text" class="layui-input userEmail" lay-verify="email" placeholder="请输入邮箱">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-inline">
                <label class="layui-form-label">性别</label>
                <div class="layui-input-block userSex">
                    <input type="radio" name="sex" value="男" title="男" checked>
                    <input type="radio" name="sex" value="女" title="女">
                    <input type="radio" name="sex" value="保密" title="保密">
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">会员等级</label>
                <div class="layui-input-block">
                    <select name="userGrade" class="userGrade" lay-filter="userGrade">
                        <option value="0">注册会员</option>
                        <option value="1">中级会员</option>
                        <option value="2">高级会员</option>
                        <option value="3">超级会员</option>
                    </select>
                </div>
            </div>
            <div class="layui-inline">
                <label class="layui-form-label">会员状态</label>
                <div class="layui-input-block">
                    <select name="userStatus" class="userStatus" lay-filter="userStatus">
                        <option value="0">正常使用</option>
                        <option value="1">限制用户</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">站点描述</label>
            <div class="layui-input-block">
                <textarea placeholder="请输入站点描述" class="layui-textarea linksDesc"></textarea>
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit="" lay-filter="addUser">立即提交</button>
                <button type="reset" class="layui-btn layui-btn-primary">重置</button>
            </div>
        </div>
    </form>

</div>
</body>
<script src="__STATIC__/layui/layui.js"></script>
<script>
    layui.use('element', function(){
        var element = layui.element;
    });
    //获取url的参数
    function getQueryString(name) {
        var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)", "i");
        var r = window.location.search.substr(1).match(reg);
        if (r != null) return unescape(r[2]);
        return null;
    }
    //用户锁定
    function lock(obj){
        if(confirm('确定要锁定该用户？')) {
            var lockid = $(obj).attr('lockid');
             console.log(lockid);
            $.ajax({
                url: "{:url('platformmanage/Userbg/userlock')}",
                data: {
                    nowuserid: lockid
                },
                type: "post",
                dattype: "",
                success: function (res) {
                    // console.log(res);
                    if (res == 1) {
                        var page = getQueryString("page");
                        window.location.href = '{:url("platformmanage/Userbg/index")}?page=' + page;
                    }
                }
            })
        }
    }
    //用户解锁
    function unlock(obj){
        if(confirm('确定要解锁该用户？')) {
            var lockid = $(obj).attr('lockid');
            console.log(lockid);
            $.ajax({
                url: "{:url('platformmanage/Userbg/userunlock')}",
                data: {
                    nowuserid: lockid
                },
                type: "post",
                dattype: "",
                success: function (res) {
                    // console.log(res);
                    if (res == 1) {
                        var page = getQueryString("page");
                        window.location.href = '{:url("platformmanage/Userbg/index")}?page=' + page;
                    }
                }
            })
        }

    }
    //添加用户
    function adduser(){
        $.ajax({
            url: "{:url('platformmanage/Userbg/useradd')}",
            data: {
                delectid: delectid
            },
            type: "post",
            datatype: "",
            success: function (res) {
                if (res == 1) {
                    var page = getQueryString("page");
                    window.location.href = '{:url("platformmanage/Userbg/index")}?page=' + page;
                }
            }
        })
    }
    //删除用户
    function delect(obj){
        if(confirm('确定要删除该用户？')){
           var delectid=$(obj).attr('delectid');
           $.ajax({
               url:"{:url('platformmanage/Userbg/userdelect')}",
               data:{
                   delectid:delectid
               },
               type:"post",
               datatype:"",
               success:function(res){
                   if (res == 1) {
                       var page = getQueryString("page");
                       alert('删除成功！');
                       window.location.href = '{:url("platformmanage/Userbg/index")}?page=' + page;
                   }
               }
           })
        }
    }
    //修改用户
    function change(obj){
        if(confirm('开始修改用户?')){
            var changeid=$(obj).attr('changeid');
            $.ajax({
                url:"{:url('platformmanage/Userbg/change')}",
                data:{
                    changeid:changeid
                },
                type:"post",
                datatype:"",
                success:function(res){
                    if (res == 1) {
                        var page = getQueryString("page");
                        window.location.href = '{:url("platformmanage/Userbg/index")}?page=' + page;
                    }
                }
            })
        }
    }
</script>
<script type="text/javascript" src="__JS__/vue.min.js"></script>
<script type="text/javascript" src="__JS__/jquery.min.js"></script>
<script type="text/javascript" src="__JS__/platform/platform.js"></script>
</html>